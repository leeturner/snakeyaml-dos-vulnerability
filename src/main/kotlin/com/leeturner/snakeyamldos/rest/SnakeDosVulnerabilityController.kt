package com.leeturner.snakeyamldos.rest

import com.leeturner.snakeyamldos.model.Person
import org.springframework.http.MediaType
import org.springframework.web.bind.annotation.PostMapping
import org.springframework.web.bind.annotation.RequestBody
import org.springframework.web.bind.annotation.RestController
import org.yaml.snakeyaml.Yaml
import org.yaml.snakeyaml.constructor.Constructor

@RestController
class SnakeDosVulnerabilityController {

    @PostMapping("parse", consumes = [MediaType.TEXT_PLAIN_VALUE])
    fun parseYamlDto(@RequestBody yaml: String) {
        println(yaml)
        val byteInputStream = yaml.byteInputStream()
        val person: Person = Yaml(Constructor(Person::class.java)).load(byteInputStream)
        println(person)
    }
}